#!/bin/sh
java_args="-Djetty.port=<%= port %> -Djetty.contextPath=<%= context %> -Djetty.shutdownSecret=<%= secret %> <%= jvm_args.join(' ') %>"

cd <%= workdir %>	

case $1 in    
    start)
        if [[ -f <%= pidfile %> ]]; then
            echo "Already running"
            exit 0
        fi
        if [[ -f <%= execjar %> ]]; then
            echo "Starting jetty"
            java ${java_args} -jar <%= execjar %> start \
                 1><%= logdir %>/stdout.log \
                 2><%= logdir %>/stderr.log &
            pid=$!
            echo "$pid" > <%= pidfile %>
            echo "Started <%= name %> with pid: ${pid}"
            exit 0
        fi
        ;;
    stop)    
        java ${java_args} -jar <%= execjar %> stop
        sleep 3
        if [[ -f <%= pidfile %> ]]; then
            pid=`cat <%= pidfile %>`
            test -z $pid || kill $pid
            rm <%= pidfile %>
            sleep 1
            echo "Stopped <%= name %> with pid: ${pid}"
        fi
        exit 0
    	;;
    status)
	    echo `java ${java_args} -jar <%= execjar %> status`
    	;;
	*)
		;;		
esac

echo "Usage: $0 <start|stop|status>"
exit 1